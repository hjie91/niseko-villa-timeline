<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Villa Construction Timeline Journal</title>
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background: #f5f5f5;
  color: #222;
  line-height: 1.6;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

header {
  background: #fff;
  padding: 30px 20px;
  margin-bottom: 30px;
  border-bottom: 2px solid #e0e0e0;
}

h1 {
  font-size: 28px;
  font-weight: 600;
  margin-bottom: 20px;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  align-items: center;
}

.controls input,
.controls select,
.controls button {
  padding: 10px 16px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  background: #fff;
}

.controls input {
  flex: 1;
  min-width: 200px;
}

.controls button {
  background: #333;
  color: #fff;
  cursor: pointer;
  border: none;
  font-weight: 500;
}

.controls button:hover {
  background: #555;
}

.year-section {
  margin-bottom: 50px;
}

.year-header {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 20px;
  color: #333;
  border-left: 4px solid #333;
  padding-left: 16px;
}

.entry-card {
  background: #fff;
  padding: 24px;
  margin-bottom: 24px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}

.entry-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
  flex-wrap: wrap;
  gap: 12px;
}

.entry-title {
  font-size: 18px;
  font-weight: 600;
  color: #111;
}

.entry-dates {
  font-size: 14px;
  color: #666;
  margin-bottom: 16px;
}

.entry-phase {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 12px;
  color: #333;
}

.status-pill {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
}

.status-on-time {
  background: #d4edda;
  color: #155724;
}

.status-slight-delay {
  background: #fff3cd;
  color: #856404;
}

.status-delayed {
  background: #f8d7da;
  color: #721c24;
}

.entry-section {
  margin-bottom: 16px;
}

.entry-section-title {
  font-size: 13px;
  font-weight: 600;
  text-transform: uppercase;
  color: #666;
  margin-bottom: 8px;
  letter-spacing: 0.5px;
}

.entry-section ul {
  list-style: none;
  padding-left: 0;
}

.entry-section li {
  padding-left: 20px;
  position: relative;
  margin-bottom: 6px;
  font-size: 14px;
  color: #444;
}

.entry-section li:before {
  content: "•";
  position: absolute;
  left: 6px;
  color: #999;
}

/* =========================
   BIGGER IMAGES (UPDATED)
   ========================= */
.photo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* was 150px */
  gap: 16px; /* was 12px */
  margin-top: 16px;
}

.photo-thumb {
  aspect-ratio: 3/2; /* was 4/3 */
  overflow: hidden;
  border-radius: 6px; /* slightly nicer with larger thumbs */
  cursor: pointer;
  background: #e0e0e0;
  position: relative;
}

.photo-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.2s;
}

.photo-thumb:hover img {
  transform: scale(1.05);
}

.photo-caption {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0,0,0,0.7);
  color: #fff;
  padding: 6px 8px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.2s;
}

.photo-thumb:hover .photo-caption {
  opacity: 1;
}

.lightbox {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.95);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.lightbox.active {
  display: flex;
}

.lightbox-content {
  max-width: 90%;
  max-height: 90%;
  position: relative;
}

/* =========================
   BIGGER LIGHTBOX (UPDATED)
   ========================= */
.lightbox-image {
  max-width: 95vw;   /* was 100% */
  max-height: 90vh;  /* was 85vh */
  display: block;
}

.lightbox-caption {
  color: #fff;
  text-align: center;
  margin-top: 12px;
  font-size: 14px;
}

.lightbox-close {
  position: absolute;
  top: 20px;
  right: 20px;
  color: #fff;
  font-size: 36px;
  cursor: pointer;
  background: none;
  border: none;
  padding: 10px;
  line-height: 1;
}

.lightbox-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255,255,255,0.2);
  color: #fff;
  border: none;
  font-size: 32px;
  padding: 20px 16px;
  cursor: pointer;
  border-radius: 4px;
}

.lightbox-nav:hover {
  background: rgba(255,255,255,0.3);
}

.lightbox-prev {
  left: 20px;
}

.lightbox-next {
  right: 20px;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 2000;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: #fff;
  padding: 30px;
  border-radius: 8px;
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
}

.modal-content h2 {
  margin-bottom: 20px;
  font-size: 20px;
}

.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
  font-size: 14px;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  font-family: inherit;
}

.form-group textarea {
  min-height: 80px;
  resize: vertical;
}

.form-group small {
  display: block;
  margin-top: 4px;
  color: #666;
  font-size: 12px;
}

.modal-actions {
  display: flex;
  gap: 12px;
  margin-top: 24px;
}

.modal-actions button {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
}

.btn-primary {
  background: #333;
  color: #fff;
}

.btn-primary:hover {
  background: #555;
}

.btn-secondary {
  background: #e0e0e0;
  color: #333;
}

.btn-secondary:hover {
  background: #ccc;
}

.json-output {
  background: #f5f5f5;
  padding: 16px;
  border-radius: 4px;
  margin-top: 16px;
  font-family: monospace;
  font-size: 12px;
  white-space: pre-wrap;
  word-wrap: break-word;
  max-height: 300px;
  overflow-y: auto;
  border: 1px solid #ddd;
}

.copy-btn {
  margin-top: 12px;
  padding: 8px 16px;
  background: #333;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}

.copy-btn:hover {
  background: #555;
}

.no-results {
  text-align: center;
  padding: 60px 20px;
  color: #666;
  font-size: 16px;
}

.storage-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}

.storage-toggle input[type="checkbox"] {
  width: auto;
}

@media (max-width: 768px) {
  .controls {
    flex-direction: column;
    align-items: stretch;
  }
  
  .controls input,
  .controls select,
  .controls button {
    width: 100%;
  }

  /* Bigger than before on mobile too */
  .photo-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* was 100px */
  }
  
  .lightbox-nav {
    font-size: 24px;
    padding: 16px 12px;
  }
  
  .lightbox-prev {
    left: 10px;
  }
  
  .lightbox-next {
    right: 10px;
  }
}
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>Villa Construction Timeline Journal</h1>
    <div class="controls">
      <input type="text" id="searchInput" placeholder="Search phase or notes...">
      <select id="yearFilter">
        <option value="">All Years</option>
      </select>
      <select id="statusFilter">
        <option value="">All Status</option>
        <option value="On time">On time</option>
        <option value="Slight delay">Slight delay</option>
        <option value="Delayed">Delayed</option>
      </select>
      <button onclick="openAddModal()">+ Add New Entry</button>
      <label class="storage-toggle">
        <input type="checkbox" id="storageToggle" onchange="toggleStorage()">
        Enable localStorage sync
      </label>
    </div>
  </header>

  <div id="timeline"></div>
  <div id="noResults" class="no-results" style="display:none;">No entries match your filters.</div>
</div>

<div id="lightbox" class="lightbox" onclick="closeLightbox(event)">
  <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
  <button class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">‹</button>
  <div class="lightbox-content">
    <img id="lightboxImage" class="lightbox-image" src="" alt="">
    <div id="lightboxCaption" class="lightbox-caption"></div>
  </div>
  <button class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">›</button>
</div>

<div id="addModal" class="modal">
  <div class="modal-content">
    <h2>Add New Entry</h2>
    <form id="entryForm" onsubmit="generateJSON(event)">
      <div class="form-group">
        <label>Year</label>
        <input type="number" id="formYear" required min="2020" max="2100">
      </div>
      <div class="form-group">
        <label>Week Number</label>
        <input type="number" id="formWeek" required min="1" max="53">
      </div>
      <div class="form-group">
        <label>Start Date</label>
        <input type="date" id="formStartDate" required>
      </div>
      <div class="form-group">
        <label>End Date</label>
        <input type="date" id="formEndDate" required>
      </div>
      <div class="form-group">
        <label>Phase</label>
        <input type="text" id="formPhase" required>
      </div>
      <div class="form-group">
        <label>Status</label>
        <select id="formStatus" required>
          <option value="On time">On time</option>
          <option value="Slight delay">Slight delay</option>
          <option value="Delayed">Delayed</option>
        </select>
      </div>
      <div class="form-group">
        <label>Summary Bullets (max 3)</label>
        <textarea id="formSummary" placeholder="One bullet per line (max 3)"></textarea>
        <small>Enter one bullet point per line</small>
      </div>
      <div class="form-group">
        <label>Next Steps (max 3)</label>
        <textarea id="formNextSteps" placeholder="One step per line (max 3)"></textarea>
        <small>Enter one step per line</small>
      </div>
      <div class="form-group">
        <label>Photos</label>
        <textarea id="formPhotos" placeholder='{"src": "images/photo.jpg", "caption": "Description"}'></textarea>
        <small>Enter one JSON object per line: {"src": "url", "caption": "text"}</small>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeAddModal()">Cancel</button>
        <button type="submit" class="btn-primary">Generate JSON</button>
      </div>
    </form>
    <div id="jsonOutput" style="display:none;">
      <div class="json-output" id="jsonContent"></div>
      <button class="copy-btn" onclick="copyJSON()">Copy to Clipboard</button>
    </div>
  </div>
</div>

<script>
/************** EDIT HERE: TIMELINE DATA **************/
let entries = [
  {
    id: "2025-W1",
    year: 2025,
    week: 1,
    startDate: "2025-12-08",
    endDate: "2025-12-12",
    phase: "Site preparation / ground investigation",
    status: "On time",
    summaryBullets: [
      "Snow clearing and site access preparation",
      "Initial groundwork activity observed",
      "Winter conditions affecting pace"
    ],
    nextSteps: [
      "Continue site preparation",
      "Confirm next contractor mobilization",
      "Track weather impact"
    ],
    photos: [
      { src: "images/2025-W50-1.jpg", caption: "Site access in winter" },
      { src: "images/2025-W50-2.jpg", caption: "Initial groundwork" },
      { src: "images/2025-W50-3.jpg", caption: "Equipment on site" }
    ]
  },
  {
    id: "2025-W2",
    year: 2025,
    week: 2,
    startDate: "2025-12-15",
    endDate: "2025-12-19",
    phase: "Continued site preparation",
    status: "On time",
    summaryBullets: [
      "Continued groundwork and measurement activities",
      "Equipment mobilisation on site",
      "Site maintained under heavy winter conditions"
    ],
    nextSteps: [
      "Confirm upcoming milestones",
      "Monitor snow/road access",
      "Request weekly photo updates"
    ],
    photos: [
      { src: "images/2025-W2-1.jpg", caption: "Groundwork progress" },
      { src: "images/2025-W2-2.jpg", caption: "Heavy equipment" }
    ]
  },
  {
    "id": "2026-W3",
    "year": 2026,
    "week": 3,
    "startDate": "2026-01-26",
    "endDate": "2026-01-31",
    "phase": "Temporary Office Installation",
    "status": "On time",
    "summaryBullets": [
      "Site office setup",
      "Generator, toilet, tanks, and equipment delivery"
    ],
    "nextSteps": [
      "Confirmation certificate under final review; expected as early as tomorrow.",
      "Column improvement works to start on 2 February."
    ],
    "photos": [
      {
        "src": "images/2026-W3-1.jpg",
        "caption": "Site office"
      },
      {
        "src": "images/2026-W3-2.jpg",
        "caption": "Site office"
      },
      {
        "src": "images/2026-W3-3.jpg",
        "caption": "Site office"
      }
    ]
  }    
];
/************** END EDIT SECTION **************/

// Global state
let currentLightboxPhotos = [];
let currentLightboxIndex = 0;
let useLocalStorage = false;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  loadFromStorage();
  renderTimeline();
  populateYearFilter();
  setupEventListeners();
});

function loadFromStorage() {
  const storageEnabled = localStorage.getItem('storageEnabled') === 'true';
  document.getElementById('storageToggle').checked = storageEnabled;
  useLocalStorage = storageEnabled;
  
  if (storageEnabled) {
    const stored = localStorage.getItem('timelineEntries');
    if (stored) {
      try {
        entries = JSON.parse(stored);
      } catch (e) {
        console.error('Failed to load from localStorage:', e);
      }
    }
  }
}

function toggleStorage() {
  useLocalStorage = document.getElementById('storageToggle').checked;
  localStorage.setItem('storageEnabled', useLocalStorage);
  
  if (useLocalStorage) {
    saveToStorage();
  }
}

function saveToStorage() {
  if (useLocalStorage) {
    localStorage.setItem('timelineEntries', JSON.stringify(entries));
  }
}

function setupEventListeners() {
  document.getElementById('searchInput').addEventListener('input', renderTimeline);
  document.getElementById('yearFilter').addEventListener('change', renderTimeline);
  document.getElementById('statusFilter').addEventListener('change', renderTimeline);
}

function populateYearFilter() {
  const years = [...new Set(entries.map(e => e.year))].sort((a, b) => b - a);
  const yearFilter = document.getElementById('yearFilter');
  yearFilter.innerHTML = '<option value="">All Years</option>';
  years.forEach(year => {
    const option = document.createElement('option');
    option.value = year;
    option.textContent = year;
    yearFilter.appendChild(option);
  });
}

function renderTimeline() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  const yearFilter = document.getElementById('yearFilter').value;
  const statusFilter = document.getElementById('statusFilter').value;
  
  // Filter entries
  let filtered = entries.filter(entry => {
    const matchesSearch = !searchTerm || 
      entry.phase.toLowerCase().includes(searchTerm) ||
      entry.summaryBullets.some(b => b.toLowerCase().includes(searchTerm)) ||
      entry.nextSteps.some(n => n.toLowerCase().includes(searchTerm));
    
    const matchesYear = !yearFilter || entry.year.toString() === yearFilter;
    const matchesStatus = !statusFilter || entry.status === statusFilter;
    
    return matchesSearch && matchesYear && matchesStatus;
  });
  
  // Sort by year and week
  filtered.sort((a, b) => {
    if (a.year !== b.year) return a.year - b.year;
    return a.week - b.week;
  });
  
  // Group by year
  const grouped = {};
  filtered.forEach(entry => {
    if (!grouped[entry.year]) grouped[entry.year] = [];
    grouped[entry.year].push(entry);
  });
  
  const timeline = document.getElementById('timeline');
  const noResults = document.getElementById('noResults');
  
  if (filtered.length === 0) {
    timeline.innerHTML = '';
    noResults.style.display = 'block';
    return;
  }
  
  noResults.style.display = 'none';
  timeline.innerHTML = '';
  
  Object.keys(grouped).sort((a, b) => a - b).forEach(year => {
    const yearSection = document.createElement('div');
    yearSection.className = 'year-section';
    
    const yearHeader = document.createElement('div');
    yearHeader.className = 'year-header';
    yearHeader.textContent = year;
    yearSection.appendChild(yearHeader);
    
    grouped[year].forEach(entry => {
      yearSection.appendChild(createEntryCard(entry));
    });
    
    timeline.appendChild(yearSection);
  });
}

function createEntryCard(entry) {
  const card = document.createElement('div');
  card.className = 'entry-card';
  
  const statusClass = entry.status.toLowerCase().replace(/ /g, '-');
  
  card.innerHTML = `
    <div class="entry-header">
      <div>
        <div class="entry-title">${entry.year} — Week ${entry.week}</div>
        <div class="entry-dates">${formatDate(entry.startDate)} – ${formatDate(entry.endDate)}</div>
      </div>
      <span class="status-pill status-${statusClass}">${entry.status}</span>
    </div>
    <div class="entry-phase">${entry.phase}</div>
    <div class="entry-section">
      <div class="entry-section-title">This Period</div>
      <ul>
        ${entry.summaryBullets.map(b => `<li>${b}</li>`).join('')}
      </ul>
    </div>
    <div class="entry-section">
      <div class="entry-section-title">Next Steps</div>
      <ul>
        ${entry.nextSteps.map(n => `<li>${n}</li>`).join('')}
      </ul>
    </div>
    ${entry.photos && entry.photos.length > 0 ? `
      <div class="photo-grid">
        ${entry.photos.map((photo, idx) => `
          <div class="photo-thumb" onclick="openLightbox(${JSON.stringify(entry.photos).replace(/"/g, '&quot;')}, ${idx})">
            <img src="${photo.src}" alt="${photo.caption}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22%3E%3Crect fill=%22%23ddd%22 width=%22400%22 height=%22300%22/%3E%3Ctext fill=%22%23999%22 x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22sans-serif%22 font-size=%2218%22%3EImage not found%3C/text%3E%3C/svg%3E'">
            <div class="photo-caption">${photo.caption}</div>
          </div>
        `).join('')}
      </div>
    ` : ''}
  `;
  
  return card;
}

function formatDate(dateStr) {
  const date = new Date(dateStr + 'T00:00:00');
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  return `${months[date.getMonth()]} ${date.getDate()}`;
}

function openLightbox(photos, index) {
  currentLightboxPhotos = photos;
  currentLightboxIndex = index;
  showLightboxImage();
  document.getElementById('lightbox').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeLightbox(event) {
  if (!event || event.target.id === 'lightbox' || event.target.className === 'lightbox-close') {
    document.getElementById('lightbox').classList.remove('active');
    document.body.style.overflow = 'auto';
  }
}

function navigateLightbox(direction) {
  currentLightboxIndex += direction;
  if (currentLightboxIndex < 0) currentLightboxIndex = currentLightboxPhotos.length - 1;
  if (currentLightboxIndex >= currentLightboxPhotos.length) currentLightboxIndex = 0;
  showLightboxImage();
}

function showLightboxImage() {
  const photo = currentLightboxPhotos[currentLightboxIndex];
  document.getElementById('lightboxImage').src = photo.src;
  document.getElementById('lightboxCaption').textContent = photo.caption;
}

function openAddModal() {
  document.getElementById('addModal').classList.add('active');
  document.getElementById('jsonOutput').style.display = 'none';
  document.getElementById('entryForm').reset();
  
  // Set defaults
  const now = new Date();
  document.getElementById('formYear').value = now.getFullYear();
  document.body.style.overflow = 'hidden';
}

function closeAddModal() {
  document.getElementById('addModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

function generateJSON(event) {
  event.preventDefault();
  
  const year = parseInt(document.getElementById('formYear').value);
  const week = parseInt(document.getElementById('formWeek').value);
  const startDate = document.getElementById('formStartDate').value;
  const endDate = document.getElementById('formEndDate').value;
  const phase = document.getElementById('formPhase').value;
  const status = document.getElementById('formStatus').value;
  
  const summaryText = document.getElementById('formSummary').value;
  const summaryBullets = summaryText.split('\n').filter(line => line.trim()).slice(0, 3);
  
  const nextStepsText = document.getElementById('formNextSteps').value;
  const nextSteps = nextStepsText.split('\n').filter(line => line.trim()).slice(0, 3);
  
  const photosText = document.getElementById('formPhotos').value;
  let photos = [];
  if (photosText.trim()) {
    try {
      photos = photosText.split('\n')
        .filter(line => line.trim())
        .map(line => JSON.parse(line.trim()));
    } catch (e) {
      alert('Invalid photo JSON format. Please check your input.');
      return;
    }
  }
  
  const newEntry = {
    id: `${year}-W${week}`,
    year,
    week,
    startDate,
    endDate,
    phase,
    status,
    summaryBullets,
    nextSteps,
    photos
  };
  
  const jsonString = JSON.stringify(newEntry, null, 2);
  document.getElementById('jsonContent').textContent = jsonString;
  document.getElementById('jsonOutput').style.display = 'block';
}

function copyJSON() {
  const jsonText = document.getElementById('jsonContent').textContent;
  navigator.clipboard.writeText(jsonText).then(() => {
    const btn = event.target;
    const originalText = btn.textContent;
    btn.textContent = 'Copied!';
    setTimeout(() => {
      btn.textContent = originalText;
    }, 2000);
  });
}

// Keyboard navigation for lightbox
document.addEventListener('keydown', function(e) {
  const lightbox = document.getElementById('lightbox');
  if (lightbox.classList.contains('active')) {
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft') navigateLightbox(-1);
    if (e.key === 'ArrowRight') navigateLightbox(1);
  }
});
</script>

</body>
</html>
